#include <tunables/global>

profile db_profile flags=(audit,attach_disconnected,mediate_deleted,complain) {
	network inet6 dgram,
	/lib/x86_64-linux-gnu/libtinfo.so.5.9 r,
	/tmp/ibAtZwWC rw,
	/usr/share/zoneinfo/Europe/Luxembourg r,
	/tmp/#sql_1_0.MAI rw,
	/tmp/ibl0bWtv rw,
	/usr/ r,
	signal (send) set=(usr1) peer=db_profile,
	/var/lib/docker/* r, #Access to layers of filesystem
	/tmp/ibMv59OL w,
	capability setgid,
	capability dac_override,
	/sys/devices/system/node/node0/meminfo r,
	/tmp/#sql_1_0.MAD w,
	/tmp/ib8rYJVw rw,
	/tmp/ibyJ8t43 w,
	/tmp/ibMv59OL rw,
	/usr/share/zoneinfo/right/NZ-CHAT r,
	/tmp/ibtoPnd4 rw,
	/tmp/ibn3gRod rw,
	/sys/devices/system/cpu/ r,
	/lib/x86_64-linux-gnu/libdl-2.27.so r,
	/tmp/ibc2DJ6Y rw,
	/usr/share/zoneinfo/right/Pacific/Bougainville r,
	/tmp/ibsEHlNU w,
	/tmp/ibyJ8t43 rw,
	signal (send) set=(term) peer=db_profile,
	/usr/share/zoneinfo/America/Detroit r,
	/usr/bin/mysql r,
	/usr/share/zoneinfo/right/Europe/Minsk r,
	/tmp/ibMiAkYZ w,
	/sys/devices/system/node/ r,
	network inet6 stream,
	/dev/urandom r,
	/tmp/ib5nY5jr rw,
	/usr/share/zoneinfo/Europe/Belgrade r,
	/tmp/ibl0bWtv w,
	/usr/share/zoneinfo/America/Scoresbysund r,
	/usr/share/zoneinfo/America/Santarem r,
	network inet dgram,
	/tmp/ibMiAkYZ rw,
	capability setuid,
	/usr/share/zoneinfo/right/Europe/Helsinki r,
	/usr/sbin/mysqld r,
	deny remount /var/lib/mysql, #Disallow anybody that wants to remount this mountpoint
	deny umount /var/lib/mysql, #Disallow anybody that wants to break this mountpoint
	/var/lib/mysql/* rw,
	/tmp/ibUkNCad rw,
	/tmp/ib5nY5jr w,
	/tmp/#sql_1_0.MAD r,
	signal (receive) set=(usr1) peer=db_profile,
	/usr/bin/gawk r,
	/tmp/ibUkNCad w,
	/tmp/ibCC5j5t w,
	/tmp/#sql_1_0.MAI r,
	/run/mysqld/mysqld.pid w,
	/usr/share/zoneinfo/America/Edmonton r,
	/ r,
	/tmp/ibxLul4g rw,
	/tmp/ibAtZwWC w,
	/usr/share/zoneinfo/GB r,
	/proc/10/status r,
	/tmp/ibtoPnd4 w,
	mount /var/lib/docker/volumes/nextcloudexample_db_/_data -> /var/lib/mysql, #Bind host volume to docker container volume
	/tmp/ib8rYJVw w,
	/usr/share/zoneinfo/America/Anguilla r,
	/tmp/ibxLul4g w,
	/var/ r,
	signal (receive) set=(term) peer=db_profile,
	/proc/106/status r,
	/usr/share/zoneinfo/UTC r,
	/usr/share/zoneinfo/America/Santo_Domingo r,
	/dev/null r,
	/tmp/ibCC5j5t rw,
	/tmp/ibc2DJ6Y w,
	/tmp/ibde3LJE rw,
	/tmp/ib8iHtLH w,
	/tmp/ r,
	/tmp/ibn3gRod w,
	/etc/ld.so.cache r,
	/tmp/ibsEHlNU rw,
	/usr/share/zoneinfo/America/Sao_Paulo r,
	/tmp/ibP7kZIe rw,
	/usr/share/zoneinfo/right/Pacific/Chuuk r,
	/usr/share/zoneinfo/right/Europe/Monaco r,
	/tmp/ibP7kZIe w,
	/tmp/ibde3LJE w,
	/tmp/ibX8Vm4H w,
	/tmp/ibX8Vm4H rw,
	file,  #This rule is needed so that I can work with files (create files/directories, copy, etc)
	/tmp/ib8iHtLH rw,
	/var/www/html/3rdparty/doctrine/dbal/lib/Doctrine/DBAL/Driver/PDOException.php r,
	/usr/share/zoneinfo/America/Santiago r,
	deny ptrace (readby, tracedby), #Confront container breakout attacks
	/tmp/ibxJE5T3 rw,
	/tmp/#sql_1_0.MAD rw,
	/tmp/#sql_1_0.MAI w,
	signal (receive) set=(kill) peer=unconfined,
	/tmp/ibxJE5T3 w,
}
